---
title: API Reference
description: Complete API surface of AuthRail.
---

import { CodeBlock, Pre } from "fumadocs-ui/components/codeblock";

# API Reference

This section documents the public API of AuthRail.

---

## createRail

<CodeBlock title="Signature">
  <Pre>{`createRail<Ctx>(
  name: string,
  middleware: Middleware<Ctx>[],
  options?: {
    debug?: boolean;
  }
): Rail<Ctx>`}</Pre>
</CodeBlock>

Creates a new rail instance.

Parameters:

- `name` — identifier used for debugging
- `middleware` — ordered array of middleware
- `options.debug` — enables console logging during evaluation

Returns:

<CodeBlock title="Rail Interface">
  <Pre>{`{
  name: string;
  evaluate(ctx: Ctx): Promise<RailResult<Ctx>>;
}`}</Pre>
</CodeBlock>

---

## Rail.evaluate

<CodeBlock title="Signature">
  <Pre>{`rail.evaluate(context: Ctx): Promise<RailResult<Ctx>>`}</Pre>
</CodeBlock>

Evaluates middleware sequentially and returns:

<CodeBlock title="RailResult">
  <Pre>{`type RailResult<Ctx> = {
  decision: {
    type: "allow" | "deny" | "redirect";
    to?: string;
    reason?: string;
  };
  context: Ctx;
};`}</Pre>
</CodeBlock>

Evaluation is always asynchronous.

---

## Middleware

<CodeBlock title="Type Definition">
  <Pre>{`type Middleware<Ctx> =
  | ((ctx: Readonly<Ctx>) =>
      | MiddlewareResult<Ctx>
      | void
      | Promise<MiddlewareResult<Ctx> | void>);`}</Pre>
</CodeBlock>

<CodeBlock title="Result Type">
  <Pre>{`type MiddlewareResult<Ctx> = {
  decision?: {
    type: "allow" | "deny" | "redirect";
    to?: string;
    reason?: string;
  };
  context?: Partial<Ctx>;
};`}</Pre>
</CodeBlock>

Rules:

- Returning `void` continues execution.
- Returning `decision` short-circuits execution.
- Returning `context` enriches the working context.

---

## requireAuth

<CodeBlock title="Helper">
  <Pre>{`requireAuth(redirectTo: string): Middleware`}</Pre>
</CodeBlock>

Redirects if `ctx.user` is falsy.

---

## requireRole

<CodeBlock title="Helper">
  <Pre>{`requireRole(role: string): Middleware`}</Pre>
</CodeBlock>

Denies if `ctx.user.role` does not match.

---

## allowIf

<CodeBlock title="Helper">
  <Pre>{`allowIf(predicate: (ctx: Ctx) => boolean): Middleware`}</Pre>
</CodeBlock>

Denies if predicate returns `false`.

---

## blockIf

<CodeBlock title="Helper">
  <Pre>{`blockIf(predicate: (ctx: Ctx) => boolean): Middleware`}</Pre>
</CodeBlock>

Denies if predicate returns `true`.

---

## React Utilities

These are optional helpers for React environments.

### RailBoundary

<CodeBlock title="Props">
  <Pre>{`<RailBoundary
  rail={rail}
  context={ctx}
  fallback={ReactNode}
  denied={ReactNode}
  onRedirect={(to) => void}
>
  {children}
</RailBoundary>`}</Pre>
</CodeBlock>

Evaluates a rail and renders based on decision.

---

### useRail

<CodeBlock title="Hook">
  <Pre>{`useRail(rail, context)`}</Pre>
</CodeBlock>

Returns:

<CodeBlock title="Result">
  <Pre>{`{
  status: "idle" | "loading" | "done";
  decision;
  context;
}`}</Pre>
</CodeBlock>

---

### protect

<CodeBlock title="HOC">
  <Pre>{`protect(
  rail,
  getContext,
  onRedirect?,
  fallback?,
  denied?
)(Component)`}</Pre>
</CodeBlock>

Higher-order component wrapper for route-level protection.
