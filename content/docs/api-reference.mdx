---
title: API Reference
description: Complete API surface of AuthRail.
---

import { CodeBlock } from "fumadocs-ui/components/codeblock";

This section documents the public API of AuthRail.

---

## createRail

<CodeBlock title="Signature">
```ts
createRail<Ctx>(
  name: string,
  middleware: Middleware<Ctx>[],
  options?: {
    debug?: boolean;
  }
): Rail<Ctx>
```
</CodeBlock>

Creates a new rail instance.

Parameters:

- `name` — identifier used for debugging
- `middleware` — ordered array of middleware
- `options.debug` — enables console logging during evaluation

Returns:

<CodeBlock title="Rail Interface">
```ts
{
  name: string;
  evaluate(ctx: Ctx): Promise<RailResult<Ctx>>;
}
```
</CodeBlock>

---

## Rail.evaluate

<CodeBlock title="Signature">
```ts
rail.evaluate(context: Ctx): Promise<RailResult<Ctx>>
```
</CodeBlock>

Evaluates middleware sequentially and returns:

<CodeBlock title="RailResult">
```ts
type RailResult<Ctx> = {
  decision: {
    type: "allow" | "deny" | "redirect";
    to?: string;
    reason?: string;
  };
  context: Ctx;
};
```
</CodeBlock>

Evaluation is always asynchronous.

---

## Middleware

<CodeBlock title="Type Definition">
```ts
type Middleware<Ctx> =
  | ((ctx: Readonly<Ctx>) =>
      | MiddlewareResult<Ctx>
      | void
      | Promise<MiddlewareResult<Ctx> | void>);
```
</CodeBlock>

<CodeBlock title="Result Type">
```ts
type MiddlewareResult<Ctx> = {
  decision?: {
    type: "allow" | "deny" | "redirect";
    to?: string;
    reason?: string;
  };
  context?: Partial<Ctx>;
};
```
</CodeBlock>

Rules:

- Returning `void` continues execution.
- Returning `decision` short-circuits execution.
- Returning `context` enriches the working context.

---

## requireAuth

<CodeBlock title="Helper">
  ```ts
  requireAuth(redirectTo: string): Middleware
  ```
</CodeBlock>

Redirects if `ctx.user` is falsy.

---

## requireRole

<CodeBlock title="Helper">
  ```ts
  requireRole(role: string): Middleware
  ```
</CodeBlock>

Denies if `ctx.user.role` does not match.

---

## allowIf

<CodeBlock title="Helper">
```ts
allowIf(predicate: (ctx: Ctx) => boolean): Middleware
```
</CodeBlock>

Denies if predicate returns `false`.

---

## blockIf

<CodeBlock title="Helper">
```ts
blockIf(predicate: (ctx: Ctx) => boolean): Middleware
```
</CodeBlock>

Denies if predicate returns `true`.

---

## React Utilities

These are optional helpers for React environments.

### RailBoundary

<CodeBlock title="Props">
```tsx
<RailBoundary
  rail={rail}
  context={ctx}
  fallback={ReactNode}
  denied={ReactNode}
  onRedirect={(to) => void}
>
  {children}
</RailBoundary>
```
</CodeBlock>

Evaluates a rail and renders based on decision.

---

### useRail

<CodeBlock title="Hook">```ts useRail(rail, context) ```</CodeBlock>

Returns:

<CodeBlock title="Result">
```ts
{
  status: "idle" | "loading" | "done";
  decision;
  context;
}
```
</CodeBlock>

---

### protect

<CodeBlock title="HOC">
  ```ts protect( rail, getContext, onRedirect?, fallback?, denied? )(Component)
  ```
</CodeBlock>

Higher-order component wrapper for route-level protection.
